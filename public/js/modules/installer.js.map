{"version":3,"sources":["installer.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"installer.js","sourcesContent":["window.onload = function () {\n    var installerSteps = $('#installer_steps');\n    installerSteps.steps({\n        headerTag: \"h3\",\n        bodyTag: \"div.section\",\n        enableAllSteps: true\n    });\n    $('.wizard > .actions').hide();\n\n    $(document).delegate('#addInput','click', function (ev) {\n        var addInputButton = $('#addInput');\n        // some stupid racing condition renders the disabled button instruction useless\n        // if the user clicks like a madman, the integer increment goes crazy\n        // like 0,1,3,4,4,4,5,7,7\n        if(!addInputButton.hasClass('disabled')) {\n\n            addInputButton.addClass('disabled');\n            \n            requester.get('installer/getinputinstaller/' + parseInt($('.inputwidg').length)).then(\n                function (success) {\n                    addInputButton.closest('.form-group').append(success.html);\n                    addInputButton.removeClass('disabled');\n                },//\n                function (fail) {\n                    console.log('fail ' . fail);\n            });        \n        }\n    });\n\n    $(document).delegate('.remove_input', 'click', function (ev) {\n        $(this).closest('.inputwidg').remove();\n    });\n\n    $(document).delegate('.destroy_input', 'click', function (ev) {\n        var thisInput = $(this);\n        // $(this).siblings('.remove_input').trigger('click');return false;\n        requester.delete($(this).data('destroy'), null, '').then(\n            function (success) {\n                $('.inputswidget').html(success.html)\n                // $(this).closest('li').remove();//\n                // thisInput.siblings('.remove_input').trigger('click');\n            },\n            function (fail) {\n\n            }\n        );\n    });\n    $(document).delegate('.restore_input', 'click', function (ev) {\n        var thisInput = $(this);\n        requester.post($(this).data('restore'), null, '').then(\n            function (success) {\n                $('.inputswidget').html(success.html)\n            },\n            function (fail) {\n\n            }\n        );\n    });\n    $(document).delegate('#installer_form', 'submit', function (ev) {\n        ev.preventDefault();\n\n        requester.post($(this).attr('action'), null, $(this).serialize()).then(\n            function (success) {\n                // $(\"#inputs\").html(success.html)\n                // $('.validation_errors').html('');\n                // $('.form-control').removeClass('error');\n            },\n\n            function (fail) {\n                parseErrorsToForm(fail);\n            }\n        );\n    });\n    $(document).delegate('#get_device_inputs_form', 'submit', function (ev) {\n        ev.preventDefault();\n        console.log($(this).serialize());\n        requester.post($(this).attr('action'), null, $(this).serialize()).then(\n            function (success) {\n                $(\"#inputs\").html(success.html)\n                $('#inputs').prepend($(\"<div class='hr-line-dashed'></div>\"));\n                // $('.validation_errors').html('');\n                // $('.form-control').removeClass('error');\n            },\n\n            function (fail) {\n                parseErrorsToForm(fail);\n            }\n        );\n    });\n    $(document).delegate('#postinput', 'submit', function (event) {\n        event.preventDefault();\n        requester.post($(this).attr('action'), null, $(this).serialize()).then(\n            function (success) {\n                // console.log([$('.inputswidget').length, success]);\n                $('.inputswidget').html(success.html)\n                $('.validation_errors').html('');\n            },\n            function (fail) {\n                parseErrorsToForm(fail);\n            }\n        );\n    });\n    $(document).delegate('#input_type', 'change', function (ev) {\n        $('#postinput').children('input').show();\n        $('#postinput').children('select').show();\n\n        var inputType = $(this).children('option:selected').text();\n\n        switch(inputType) {\n            case 'digital':\n                $('.analog').hide();\n                $('.one_wire').hide();\n                // $('input.analog, input.one_wire, select.analog, select.one_wire').hide();\n                $('.digital').show();\n                break;\n            case '1wire':\n                $('.analog').hide();\n                $('.digital').hide();\n                $('.one_wire').show();\n                break;\n            case 'analog':\n                $('.digital').hide();\n                $('.one_wire').hide();\n                $('.analog').show();            \n            default: return;\n        }\n    });\n    var hideNonMandatoryTranslationFields = function () {\n        if ($('#input_type>option:selected').html() != 'digital') {\n            $.each($('.digital_on'), function () {\n                $(this).closest('.form-group').first().addClass('digital').hide();\n            });\n            $.each($('.digital_off'), function () {\n                $(this).closest('.form-group').first().addClass('digital').hide();\n            });\n        } else {\n            $.each($('.digital_on'), function () {\n                $(this).closest('.form-group').first().show();\n            });\n            $.each($('.digital_off'), function () {\n                $(this).closest('.form-group').first().show();\n            });\n        }\n    }\n    $(document).delegate('.manage_inputs.edit_input, .manage_inputs.add_input', 'click', function(e) {\n        requester.get($(this).data('get'), null, null).then(\n            function (success) {\n                $('.validation_errors').html('');\n                $('.inputwidget').html(success.html);\n                $('#input_type').trigger('change');\n                hideNonMandatoryTranslationFields();\n            },\n            function (fail) {\n\n            }\n        );\n    });\n/**\n * Parse and show errors\n */\nvar parseErrorsToForm = function (errors) {\n    // Remove error class from input fields\n    $('.form-control').removeClass('error');\n\n    $('.validation_errors').html('');\n\n    // Create alert with error messages\n    var div = $(document.createElement('div'));\n    div.addClass('alert alert-danger alert-dismissable');\n    div.html('<button aria-hidden=\"true\" data-dismiss=\"alert\" class=\"close\" type=\"button\">Ã—</button>');\n\n    // Loop errors\n    $.each(errors.responseJSON, function (key, value) {\n        // Replace names of the fields which are named with array format (.1 with [1]). Example: first_name.1 to first_name[1]\n        if (key.indexOf('.') !== -1) {\n            key = key.split('.').join('][');\n            key = key.replace(/\\./g, '][');\n            key = key.replace(']', '');\n            key += ']';\n        }\n\n        // Add error class to fields with mistake\n        $(\"input[name='\" + key + \"'], select[name='\" + key + \"'], textarea[name='\" + key + \"']\").addClass('error');\n        // Add error to alert\n        div.append('<div class=\"text-left\">' + value + '</div>');\n    });\n\n    $('.validation_errors').append(div);\n}\n};"],"sourceRoot":"/source/"}