{"version":3,"sources":["show_notification_violation.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"show_notification_violation.js","sourcesContent":["var app = app || {};\nvar violationNotificationMapper = undefined;\n\n$(document).ready(function()\n{\n    var requester = app.requester.load();\n});\n\n$(document).delegate('.violation_notification_count > a', 'click', function (e) {\n    e.preventDefault();\n    $('.violation_notifications').html('');\n\n    requester.get(window.location.protocol + '//' + location.hostname + '/violationNotifications').then(\n        function (success) {\n            $('.violation_notifications').html(success.html);\n        },\n        function (fail) {\n            console.log('fail');\n        }\n    );\n});\n\n$(document).delegate('#view_violation_data', 'click', function (ev)\n{\n    ev.preventDefault();\n    var violationId = $(this).data('id');\n    displayViolation(violationId);\n});\n\n$(document).delegate('.view_violation', 'click', function (ev)\n{\n    ev.preventDefault();\n    var id = $(this).data('violation');\n\n    displayViolation(id);\n});\n\nfunction displayViolation(id)\n{\n    requester.get('/getViolation/' + id).then(function (success)\n    {\n        $('#view_violation_modal').modal('show');\n\n        if (violationNotificationMapper != undefined)\n        {\n            violationNotificationMapper.clearAreas();\n            violationNotificationMapper.map.remove();\n        }\n\n        violationNotificationMapper = app.mapper.load('view_violation_map', false);\n        var violationData = success.violationData;\n        var latLngs = [];\n        var trackedObjectRouteLatLngs = [];\n        // console.log(violationData);\n\n        /**\n         * Draw restriction area\n         * Sometimes area is deleted, but violation exists\n         */\n        if (violationData.isArea && violationData.area && violationData.area.area_points)\n        {\n            $.each(violationData.area.area_points, function (n, point) {\n                var latLngPoint = [parseFloat(point.latitude), parseFloat(point.longitude)];\n                latLngs.push(latLngPoint);\n            });\n\n            if (violationData.area.area_type == 'circle')\n            {\n                violationNotificationMapper.drawCircle(latLngs, parseFloat(violationData.area.radius));\n            }\n            else\n            {\n                violationNotificationMapper.drawPolygon(latLngs);\n            }\n        }\n\n        // Draw violation speed/area\n        if (violationData.trackedObjectPositions.length > 0)\n        {\n            $.each(violationData.trackedObjectPositions, function (n, point)\n            {\n                // Create point objects\n                var latLngPoint = [parseFloat(point.latitude), parseFloat(point.longitude)];\n\n                // If speed is violated\n                if (violationData.isSpeed && parseFloat(point.speed) > parseFloat(violationData.speed))\n                {\n                    // Assign marker if speed is violated\n                    var marker = L.marker(latLngPoint,\n                            {\n                                icon: speed_violated\n                            })\n                            .addTo(violationNotificationMapper.map);\n                    violationNotificationMapper.featureGroup.addLayer(marker);\n                    marker.bindPopup(\n                    translations.allowed_speed + \": \" + violationData.speed + \"<br/>\" +\n                    translations.current_speed + \": \" + point.speed);\n                }\n\n                // If area is violated\n                if (violationData.isArea)\n                {\n                    trackedObjectRouteLatLngs.push(latLngPoint);\n                }\n            });\n\n            // Add area violation line to map\n            violationNotificationMapper.drawPolyline(trackedObjectRouteLatLngs);\n        }\n\n        // Fit Bounds\n        if(violationNotificationMapper.featureGroup.getLayers().length != 0)\n        {\n            setTimeout(function (){\n                violationNotificationMapper.map.fitBounds(\n                    violationNotificationMapper.featureGroup.getBounds(),\n                    {padding: [50, 50]}\n                );\n            }, 100);\n        }\n    });\n}\n\n"],"sourceRoot":"/source/"}